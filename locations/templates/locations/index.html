<!doctype html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="http://code.jquery.com/jquery-2.2.1.min.js"></script>
    <title>visingsomrade</title>
    <style>
      #map {width: 800px; height: 500px}
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      function initMap() {
        // Create the viewport map
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5,
          center: new google.maps.LatLng(41.637086, -0.885620)
        });
        var geocoder = new google.maps.Geocoder;

        // Add a marker when you click
        map.addListener('click', function(event) {
          placeMarker(event.latLng, map, geocoder);
        });
      }

      // Nothing in the wood or mountain
      var valid_types = new Set(["street_address", "premise",
                                 "intersection", "ward", "locality", "sublocality",
                                 "neighborhood", "airport", "point_of_interest"]);

      // Place a marker if the position has a real address
      function placeMarker(location, map, geocoder) {
        geocoder.geocode({'location': location}, function(results, status) {
          if (status === google.maps.GeocoderStatus.OK) {
            if (results[0]) {
               console.log("Formatted address: " + results[0]['formatted_address']);
               console.log("Types: " + results[0]['types']);
               for (type of results[0]['types']) {
                 if (valid_types.has(type)) {
                      var marker = new google.maps.Marker({position: location,
                                                           map: map});
                      break;
                 }
               }
            } else {
               console.log("No results for geocoder reverse lookup...");
            }
          } else {
            console.log("No response: " + status);
          }
        });
      }
    </script>
    <script async defer src="http://maps.google.com/maps/api/js?callback=initMap"></script>
  </body>
</html>
